#!/bin/bash
# adds ~/.ssh/config to the ssh autocomplete
# Call whenever ssh host config changes (@see ssh_configure_host)
# @TODO: experiment with file listener to update autocomplete automatically
if ! command -v awk >/dev/null
then
  echo "/!\ awk is unavailable.  Aborting..(~/.bash/ssh/ssh_config_autocomplete_load)"; return
fi
dir="$HOME/.ssh/{config,conf.d/*.conf}"
echo "* completion \"ssh_config\" ${dir}"
complete -W "$(awk '/^\s*Host\s*/ { sub(/^\s*Host /, ""); print; }' $HOME/.ssh/{config,conf.d/*.conf})" ssh
